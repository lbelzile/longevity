<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="longevity">
<title>Introducing longevity • longevity</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introducing longevity">
<meta property="og:description" content="longevity">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">longevity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2023.09.13</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction.html">Introducing longevity</a>
    <a class="dropdown-item" href="../articles/nonparametric.html">Nonparametric maximum likelihood estimation for survival data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lbelzile/longevity/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="introduction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introducing longevity</h1>
                        <h4 data-toc-skip class="author">Léo Belzile</h4>
            
            <h4 data-toc-skip class="date">2023-11-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lbelzile/longevity/blob/HEAD/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="what-does-longevity-do">What does longevity do?<a class="anchor" aria-label="anchor" href="#what-does-longevity-do"></a>
</h2>
<p>The <code>longevity</code> package provides a variety of numerical routines for parametric and nonparametric models for positive data subject to non informative censoring and truncation mechanisms. The package includes functions to estimate various parametric model parameters via maximum likelihood, produce diagnostic plots accounting for survival patterns, compare nested models using analysis of deviance, etc.</p>
<p>The syntax of <code>longevity</code> follows that of the popular <code>survival</code> package, but forgoes the specification of <code>Surv</code> type objects: rather, users must specify some of the following</p>
<ul>
<li>the time vector <code>time</code> (a left interval if <code>time2</code> is provided)</li>
<li>the right interval <code>time2</code> for interval censoring</li>
<li>a vector or scalar <code>event</code> indicating whether data are right, left or interval censored. The option <code>interval2</code>, for interval censoring, is useful if both <code>time</code> and <code>time2</code> vectors are provided with (potentially zero or infinite bounds) for censored observations.</li>
<li>the status indicator, <code>event</code>, with 0 for right censored, 1 for observed event, 2 for left censored and 3 for interval censored. If omitted, <code>event</code> is set to 1 for all subjects.</li>
<li>
<code>ltrunc</code> and <code>rtrunc</code> for left and right truncation values. If omitted, they are set to 0 and <span class="math inline">\(\infty\)</span>, respectively.</li>
</ul>
<p>The reason for specifying the <code>ltrunc</code> and <code>rtrunc</code> vector outside of the usual arguments is to accomodate instances where there is both interval censoring and interval truncation; <code>survival</code> supports left-truncation right-censoring for time-varying covariate models, but this isn’t really transparent.</p>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>We consider Dutch data from CBS; these data were analysed in <span class="citation">Einmahl, Einmahl, and Haan (2019)</span>. For simplicity, we keep only Dutch people born in the Netherlands, who were at least centenarians when they died and whose death date is known.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thresh0</span> <span class="op">&lt;-</span> <span class="fl">36525</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dutch</span>, package <span class="op">=</span> <span class="st">"longevity"</span><span class="op">)</span></span>
<span><span class="va">dutch1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dutch</span>, <span class="va">ndays</span> <span class="op">&gt;</span> <span class="va">thresh0</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ndays</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">valid</span> <span class="op">==</span> <span class="st">"A"</span><span class="op">)</span></span></code></pre></div>
<p>We can fit various parametric models accounting for the fact that data are interval truncated. First, we create a list to avoid having to type the name of all arguments repeatedly. These, if not provided directly to function, are selected from the list through <code>arguments</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">dutch1</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="va">ndays</span>,  <span class="co"># time vector</span></span>
<span>  ltrunc <span class="op">=</span> <span class="va">ltrunc</span>, <span class="co"># left truncation bound</span></span>
<span>  rtrunc <span class="op">=</span> <span class="va">rtrunc</span>, <span class="co"># right truncation</span></span>
<span>  thresh <span class="op">=</span> <span class="va">thresh0</span>, <span class="co"># threshold (model only exceedances)</span></span>
<span>  family <span class="op">=</span> <span class="st">"gp"</span><span class="op">)</span><span class="op">)</span> <span class="co"># choice of parametric model</span></span></code></pre></div>
<p>The generalized Pareto distribution can be used for extrapolation, provided that the threshold is high enough that shape estimates are more or less stable. To check this, we can produce threshold stability plots, which display point estimates with 95% profile-based pointwise confidence intervals.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tstab_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tstab.html">tstab</a></span><span class="op">(</span></span>
<span>  arguments <span class="op">=</span> <span class="va">args</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"gp"</span>, <span class="co"># parametric model, here generalized Pareto</span></span>
<span>  thresh <span class="op">=</span> <span class="fl">102</span><span class="op">:</span><span class="fl">108</span> <span class="op">*</span> <span class="fl">365.25</span>, <span class="co"># overwrites thresh</span></span>
<span>  method <span class="op">=</span> <span class="st">"wald"</span>, <span class="co"># type of interval, Wald or profile-likelihood</span></span>
<span>  plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># by default, calls 'plot' routine</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tstab_c</span>, </span>
<span>     which.plot <span class="op">=</span> <span class="st">"shape"</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"threshold (age in days)"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="introduction_files/figure-html/fig-tstab-1.png" alt="Threshold stability plot with generalized Pareto shape estimates for Dutch data as a function of threshold (in years)." width="768"><p class="caption">
Threshold stability plot with generalized Pareto shape estimates for Dutch data as a function of threshold (in years).
</p>
</div>
<p>We can fit various parametric models and compare them using the <code>anova</code> call, provided they are nested and share the same data. Diagnostic plots, adapted for survival data, can be used to check goodness-of-fit. These may be computationally intensive to produce in large samples, since they require estimation of the nonparametric maximum likelihood estimator of the distribution function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_elife.html">fit_elife</a></span><span class="op">(</span>arguments <span class="op">=</span> <span class="va">args</span>, </span>
<span>          thresh <span class="op">=</span> <span class="fl">105</span> <span class="op">*</span> <span class="fl">365.25</span>,</span>
<span>          family <span class="op">=</span> <span class="st">"gp"</span>,</span>
<span>          export <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Model: generalized Pareto distribution. </span></span>
<span><span class="co">## Sampling: interval truncated</span></span>
<span><span class="co">## Log-likelihood: -6335.799 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Threshold: 38351.25 </span></span>
<span><span class="co">## Number of exceedances: 886 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimates</span></span>
<span><span class="co">##    scale     shape  </span></span>
<span><span class="co">## 572.8722   -0.0748  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Standard Errors</span></span>
<span><span class="co">##  scale   shape  </span></span>
<span><span class="co">## 1.4122  0.0238  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Optimization Information</span></span>
<span><span class="co">##   Convergence: TRUE</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_elife.html">fit_elife</a></span><span class="op">(</span>arguments <span class="op">=</span> <span class="va">args</span>, </span>
<span>          thresh <span class="op">=</span> <span class="fl">105</span> <span class="op">*</span> <span class="fl">365.25</span>,</span>
<span>          family <span class="op">=</span> <span class="st">"exp"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">m0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     npar Deviance Df    Chisq Pr(&gt;Chisq)</span></span>
<span><span class="co">## gp     2 12671.60 NA       NA         NA</span></span>
<span><span class="co">## exp    1 12675.91  1 4.314994 0.03777791</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m1</span>, which.plot <span class="op">=</span> <span class="st">"qq"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="introduction_files/figure-html/fit-models-1.png" alt="Quantile-quantile plot of generalized Pareto model to exceedances above 105 years for Dutch." width="80%"><p class="caption">
Quantile-quantile plot of generalized Pareto model to exceedances above 105 years for Dutch.
</p>
</div>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({  "HTML-CSS": { minScaleAdjust: 125, availableFonts: [] }  });
</script><div id="refs" class="references hanging-indent">
<div id="ref-Einmahl:2019">
<p>Einmahl, Jesson J., John H. J. Einmahl, and Laurens de Haan. 2019. “Limits to Human Life Span Through Extreme Value Theory.” <em>Journal of the American Statistical Association</em> 114 (527): 1075–80. <a href="https://doi.org/10.1080/01621459.2018.1537912" class="external-link">https://doi.org/10.1080/01621459.2018.1537912</a>.</p>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Leo Belzile.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
